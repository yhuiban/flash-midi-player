<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>libfluidsynth: src/fluid_event.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>src/fluid_event.c</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* FluidSynth - A Software Synthesizer</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (C) 2003  Peter Hanappe and others.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
<a name="l00006"></a>00006 <span class="comment"> * modify it under the terms of the GNU Library General Public License</span>
<a name="l00007"></a>00007 <span class="comment"> * as published by the Free Software Foundation; either version 2 of</span>
<a name="l00008"></a>00008 <span class="comment"> * the License, or (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This library is distributed in the hope that it will be useful, but</span>
<a name="l00011"></a>00011 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment"> * Library General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * You should have received a copy of the GNU Library General Public</span>
<a name="l00016"></a>00016 <span class="comment"> * License along with this library; if not, write to the Free</span>
<a name="l00017"></a>00017 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA</span>
<a name="l00018"></a>00018 <span class="comment"> * 02111-1307, USA</span>
<a name="l00019"></a>00019 <span class="comment"> */</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="comment">/*</span>
<a name="l00023"></a>00023 <span class="comment"> 2002 : API design by Peter Hanappe and Antoine Schmitt</span>
<a name="l00024"></a>00024 <span class="comment"> August 2002 : Implementation by Antoine Schmitt as@gratin.org</span>
<a name="l00025"></a>00025 <span class="comment">               as part of the infiniteCD author project</span>
<a name="l00026"></a>00026 <span class="comment">               http://www.infiniteCD.org/</span>
<a name="l00027"></a>00027 <span class="comment"> Oct4.2002 : AS : corrected bug in heap allocation, that caused a crash during sequencer free.</span>
<a name="l00028"></a>00028 <span class="comment">*/</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#include "fluid_event_priv.h"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "fluidsynth_priv.h"</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">/***************************************************************</span>
<a name="l00035"></a>00035 <span class="comment"> *</span>
<a name="l00036"></a>00036 <span class="comment"> *                           SEQUENCER EVENTS</span>
<a name="l00037"></a>00037 <span class="comment"> */</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="comment">/* Event alloc/free */</span>
<a name="l00040"></a>00040 
<a name="l00045"></a>00045 fluid_event_t*
<a name="l00046"></a><a class="code" href="event_8h.html#1d535480f26630b755102415a6d246cb">00046</a> <a class="code" href="event_8h.html#1d535480f26630b755102415a6d246cb" title="Create a new sequencer event structure.">new_fluid_event</a>()
<a name="l00047"></a>00047 {
<a name="l00048"></a>00048   fluid_event_t* evt;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050   evt = FLUID_NEW(fluid_event_t);
<a name="l00051"></a>00051   <span class="keywordflow">if</span> (evt == NULL) {
<a name="l00052"></a>00052     <a class="code" href="log_8h.html#3daee03b354d1f66f4ee180ca97ccfc6" title="Print a message to the log.">fluid_log</a>(<a class="code" href="log_8h.html#a341232c15addd9c336131984840ed9e62d9ddd89d0a853606ce38d195daa99a" title="The synth can&amp;#39;t function correctly any more.">FLUID_PANIC</a>, <span class="stringliteral">"event: Out of memory\n"</span>);
<a name="l00053"></a>00053     <span class="keywordflow">return</span> NULL;
<a name="l00054"></a>00054   }
<a name="l00055"></a>00055 
<a name="l00056"></a>00056   FLUID_MEMSET(evt, 0, <span class="keyword">sizeof</span>(fluid_event_t));
<a name="l00057"></a>00057 
<a name="l00058"></a>00058   <span class="comment">// by default, no type</span>
<a name="l00059"></a>00059   evt-&gt;dest = -1;
<a name="l00060"></a>00060   evt-&gt;src = -1;
<a name="l00061"></a>00061   evt-&gt;type = -1;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063   <span class="keywordflow">return</span>(evt);
<a name="l00064"></a>00064 }
<a name="l00065"></a>00065 
<a name="l00070"></a>00070 <span class="keywordtype">void</span>
<a name="l00071"></a><a class="code" href="event_8h.html#473c54f0c43bdea789b211c23c7daeee">00071</a> <a class="code" href="event_8h.html#473c54f0c43bdea789b211c23c7daeee" title="Delete a sequencer event structure.">delete_fluid_event</a>(fluid_event_t* evt)
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073 
<a name="l00074"></a>00074   <span class="keywordflow">if</span> (evt == NULL) {
<a name="l00075"></a>00075     <span class="keywordflow">return</span>;
<a name="l00076"></a>00076   }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   FLUID_FREE(evt);
<a name="l00079"></a>00079 }
<a name="l00080"></a>00080 
<a name="l00087"></a>00087 <span class="keywordtype">void</span>
<a name="l00088"></a>00088 fluid_event_set_time(fluid_event_t* evt, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> time)
<a name="l00089"></a>00089 {
<a name="l00090"></a>00090         evt-&gt;time = time;
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00098"></a>00098 <span class="keywordtype">void</span>
<a name="l00099"></a><a class="code" href="event_8h.html#22e7fc6d5ce4ca9eab6dd6d60c85d78b">00099</a> <a class="code" href="event_8h.html#22e7fc6d5ce4ca9eab6dd6d60c85d78b" title="Set source of a sequencer event (DOCME).">fluid_event_set_source</a>(fluid_event_t* evt, <span class="keywordtype">short</span> src)
<a name="l00100"></a>00100 {
<a name="l00101"></a>00101         evt-&gt;src = src;
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00109"></a>00109 <span class="keywordtype">void</span>
<a name="l00110"></a><a class="code" href="event_8h.html#e0857e30ffdcfe4e277eb3c55df7ba32">00110</a> <a class="code" href="event_8h.html#e0857e30ffdcfe4e277eb3c55df7ba32" title="Set destination of a sequencer event (DOCME).">fluid_event_set_dest</a>(fluid_event_t* evt, <span class="keywordtype">short</span> dest)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112         evt-&gt;dest = dest;
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00120"></a>00120 <span class="keywordtype">void</span>
<a name="l00121"></a><a class="code" href="event_8h.html#a99a8c9110e819b53fc42baa0bfd8fbf">00121</a> <a class="code" href="event_8h.html#a99a8c9110e819b53fc42baa0bfd8fbf" title="Set a sequencer event to be a timer event.">fluid_event_timer</a>(fluid_event_t* evt, <span class="keywordtype">void</span>* data)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb98e48d4a9631bb13cd04a79588e6fc0e" title="Timer event (DOCME).">FLUID_SEQ_TIMER</a>;
<a name="l00124"></a>00124         evt-&gt;data = data;
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00134"></a>00134 <span class="keywordtype">void</span>
<a name="l00135"></a><a class="code" href="event_8h.html#1337c75403ebf9c43607a3f3139c6bba">00135</a> <a class="code" href="event_8h.html#1337c75403ebf9c43607a3f3139c6bba" title="Set a sequencer event to be a note on event.">fluid_event_noteon</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> key, <span class="keywordtype">short</span> vel)
<a name="l00136"></a>00136 {
<a name="l00137"></a>00137         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb4431305a2aaadde363a1b247636de7a7" title="Note on event.">FLUID_SEQ_NOTEON</a>;
<a name="l00138"></a>00138         evt-&gt;channel = channel;
<a name="l00139"></a>00139         evt-&gt;key = key;
<a name="l00140"></a>00140         evt-&gt;vel = vel;
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00149"></a>00149 <span class="keywordtype">void</span>
<a name="l00150"></a><a class="code" href="event_8h.html#0aae74aab2dae9597e4e1c402474629a">00150</a> <a class="code" href="event_8h.html#0aae74aab2dae9597e4e1c402474629a" title="Set a sequencer event to be a note off event.">fluid_event_noteoff</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> key)
<a name="l00151"></a>00151 {
<a name="l00152"></a>00152         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb45e4e32b1c0aefaa6533c732b8f120a1" title="Note off event.">FLUID_SEQ_NOTEOFF</a>;
<a name="l00153"></a>00153         evt-&gt;channel = channel;
<a name="l00154"></a>00154         evt-&gt;key = key;
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00165"></a>00165 <span class="keywordtype">void</span>
<a name="l00166"></a><a class="code" href="event_8h.html#f5acbb33df8307c8c35f234dcf22e287">00166</a> <a class="code" href="event_8h.html#f5acbb33df8307c8c35f234dcf22e287" title="Set a sequencer event to be a note duration event.">fluid_event_note</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> key, <span class="keywordtype">short</span> vel, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> duration)
<a name="l00167"></a>00167 {
<a name="l00168"></a>00168         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb4c293bd1d1925513766f3a25699a8cbb" title="Note event (DOCME).">FLUID_SEQ_NOTE</a>;
<a name="l00169"></a>00169         evt-&gt;channel = channel;
<a name="l00170"></a>00170         evt-&gt;key = key;
<a name="l00171"></a>00171         evt-&gt;vel = vel;
<a name="l00172"></a>00172         evt-&gt;duration = duration;
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00180"></a>00180 <span class="keywordtype">void</span>
<a name="l00181"></a><a class="code" href="event_8h.html#143083b6d7ecd8fb43862b828324faf8">00181</a> <a class="code" href="event_8h.html#143083b6d7ecd8fb43862b828324faf8" title="Set a sequencer event to be an all sounds off event.">fluid_event_all_sounds_off</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel)
<a name="l00182"></a>00182 {
<a name="l00183"></a>00183         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640ebc1594ded0babd5412fc714d017dd7a76" title="All sounds off event.">FLUID_SEQ_ALLSOUNDSOFF</a>;
<a name="l00184"></a>00184         evt-&gt;channel = channel;
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00192"></a>00192 <span class="keywordtype">void</span>
<a name="l00193"></a><a class="code" href="event_8h.html#a31eef4a0aae5c47c3600b92fc4a2d3f">00193</a> <a class="code" href="event_8h.html#a31eef4a0aae5c47c3600b92fc4a2d3f" title="Set a sequencer event to be a all notes off event.">fluid_event_all_notes_off</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel)
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb05e9f160eea1d6aeb43299b7bd45530f" title="All notes off event.">FLUID_SEQ_ALLNOTESOFF</a>;
<a name="l00196"></a>00196         evt-&gt;channel = channel;
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 
<a name="l00205"></a>00205 <span class="keywordtype">void</span>
<a name="l00206"></a><a class="code" href="event_8h.html#c1efab3eb83a6591a31f5bdaf078a3e1">00206</a> <a class="code" href="event_8h.html#c1efab3eb83a6591a31f5bdaf078a3e1" title="Set a sequencer event to be a bank select event.">fluid_event_bank_select</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> bank_num)
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640ebe9220e7834a0ec629320c4a4e0dd9547" title="Bank select message.">FLUID_SEQ_BANKSELECT</a>;
<a name="l00209"></a>00209         evt-&gt;channel = channel;
<a name="l00210"></a>00210         evt-&gt;control = bank_num;
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00219"></a>00219 <span class="keywordtype">void</span>
<a name="l00220"></a><a class="code" href="event_8h.html#2cad84c0b644e7da4ec8f4f7f3175bd5">00220</a> <a class="code" href="event_8h.html#2cad84c0b644e7da4ec8f4f7f3175bd5" title="Set a sequencer event to be a program change event.">fluid_event_program_change</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> val)
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb7981ce96e3c2feaaecf240e7095b88e8" title="Program change message.">FLUID_SEQ_PROGRAMCHANGE</a>;
<a name="l00223"></a>00223         evt-&gt;channel = channel;
<a name="l00224"></a>00224         evt-&gt;value = val;
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00235"></a>00235 <span class="keywordtype">void</span>
<a name="l00236"></a><a class="code" href="event_8h.html#fefaed0bd14754be5117fd1aff61fcd3">00236</a> <a class="code" href="event_8h.html#fefaed0bd14754be5117fd1aff61fcd3" title="Set a sequencer event to be a program select event.">fluid_event_program_select</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel,
<a name="l00237"></a>00237                                                   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sfont_id, <span class="keywordtype">short</span> bank_num, <span class="keywordtype">short</span> preset_num)
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb32692d9a15f57411d8e340ce042a6b95" title="Program select message (DOCME).">FLUID_SEQ_PROGRAMSELECT</a>;
<a name="l00240"></a>00240         evt-&gt;channel = channel;
<a name="l00241"></a>00241         evt-&gt;duration = sfont_id;
<a name="l00242"></a>00242         evt-&gt;value = preset_num;
<a name="l00243"></a>00243         evt-&gt;control = bank_num;
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00252"></a>00252 <span class="keywordtype">void</span>
<a name="l00253"></a><a class="code" href="event_8h.html#2bcfb6172492cf93b1f3d322ee120f6b">00253</a> <a class="code" href="event_8h.html#2bcfb6172492cf93b1f3d322ee120f6b" title="Set a sequencer event to be an any control change event.">fluid_event_any_control_change</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel)
<a name="l00254"></a>00254 {
<a name="l00255"></a>00255         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb37bcf291c28adf61758aed0145a69b9c" title="DOCME (used for remove_events only).">FLUID_SEQ_ANYCONTROLCHANGE</a>;
<a name="l00256"></a>00256         evt-&gt;channel = channel;
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00265"></a>00265 <span class="keywordtype">void</span>
<a name="l00266"></a><a class="code" href="event_8h.html#144992d13bb535115daebcfe22f76449">00266</a> <a class="code" href="event_8h.html#144992d13bb535115daebcfe22f76449" title="Set a sequencer event to be a pitch bend event.">fluid_event_pitch_bend</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">int</span> pitch)
<a name="l00267"></a>00267 {
<a name="l00268"></a>00268         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb291c7d4e11f8fc03b562e6a32fe49901" title="Pitch bend message.">FLUID_SEQ_PITCHBEND</a>;
<a name="l00269"></a>00269         evt-&gt;channel = channel;
<a name="l00270"></a>00270         <span class="keywordflow">if</span> (pitch &lt; 0) pitch = 0;
<a name="l00271"></a>00271         <span class="keywordflow">if</span> (pitch &gt; 16383) pitch = 16383;
<a name="l00272"></a>00272         evt-&gt;pitch = pitch;
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00281"></a>00281 <span class="keywordtype">void</span>
<a name="l00282"></a><a class="code" href="event_8h.html#640edac99d3aee21e453038d478ae215">00282</a> <a class="code" href="event_8h.html#640edac99d3aee21e453038d478ae215" title="Set a sequencer event to be a pitch wheel sensitivity event.">fluid_event_pitch_wheelsens</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> value)
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb8572affea1e2f8b811f12c649b0c35a2" title="Pitch wheel sensitivity set message.">FLUID_SEQ_PITCHWHHELSENS</a>;
<a name="l00285"></a>00285         evt-&gt;channel = channel;
<a name="l00286"></a>00286         evt-&gt;value = value;
<a name="l00287"></a>00287 }
<a name="l00288"></a>00288 
<a name="l00295"></a>00295 <span class="keywordtype">void</span>
<a name="l00296"></a><a class="code" href="event_8h.html#ec7d59df119bb0b82da90f0cd3a50d03">00296</a> <a class="code" href="event_8h.html#ec7d59df119bb0b82da90f0cd3a50d03" title="Set a sequencer event to be a modulation event.">fluid_event_modulation</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> val)
<a name="l00297"></a>00297 {
<a name="l00298"></a>00298         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb51375e58f50cda291818b26396df9659" title="Modulation controller event.">FLUID_SEQ_MODULATION</a>;
<a name="l00299"></a>00299         evt-&gt;channel = channel;
<a name="l00300"></a>00300         <span class="keywordflow">if</span> (val &lt; 0) val = 0;
<a name="l00301"></a>00301         <span class="keywordflow">if</span> (val &gt; 127) val = 127;
<a name="l00302"></a>00302         evt-&gt;value = val;
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00311"></a>00311 <span class="keywordtype">void</span>
<a name="l00312"></a><a class="code" href="event_8h.html#722a2f460a251ee79eea22ae24ed8bc3">00312</a> <a class="code" href="event_8h.html#722a2f460a251ee79eea22ae24ed8bc3" title="Set a sequencer event to be a MIDI sustain event.">fluid_event_sustain</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> val)
<a name="l00313"></a>00313 {
<a name="l00314"></a>00314         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb25aa6c9385a294189c6b18544350734d" title="Sustain controller event.">FLUID_SEQ_SUSTAIN</a>;
<a name="l00315"></a>00315         evt-&gt;channel = channel;
<a name="l00316"></a>00316         <span class="keywordflow">if</span> (val &lt; 0) val = 0;
<a name="l00317"></a>00317         <span class="keywordflow">if</span> (val &gt; 127) val = 127;
<a name="l00318"></a>00318         evt-&gt;value = val;
<a name="l00319"></a>00319 }
<a name="l00320"></a>00320 
<a name="l00328"></a>00328 <span class="keywordtype">void</span>
<a name="l00329"></a><a class="code" href="event_8h.html#d2fdd4dca4a9e35bdb1baa00ec71815c">00329</a> <a class="code" href="event_8h.html#d2fdd4dca4a9e35bdb1baa00ec71815c" title="Set a sequencer event to be a MIDI control change event.">fluid_event_control_change</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> control, <span class="keywordtype">short</span> val)
<a name="l00330"></a>00330 {
<a name="l00331"></a>00331         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb3071c5720b0b969045a4c0f8a3be40bf" title="MIDI control change event.">FLUID_SEQ_CONTROLCHANGE</a>;
<a name="l00332"></a>00332         evt-&gt;channel = channel;
<a name="l00333"></a>00333         evt-&gt;control = control;
<a name="l00334"></a>00334         evt-&gt;value = val;
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00343"></a>00343 <span class="keywordtype">void</span>
<a name="l00344"></a><a class="code" href="event_8h.html#fefff699a76b7e28461d7bfe814cce18">00344</a> <a class="code" href="event_8h.html#fefff699a76b7e28461d7bfe814cce18" title="Set a sequencer event to be a stereo pan event.">fluid_event_pan</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> val)
<a name="l00345"></a>00345 {
<a name="l00346"></a>00346         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640ebdbea6248d4dc02056e4c3d3c64930643" title="Stereo pan set event.">FLUID_SEQ_PAN</a>;
<a name="l00347"></a>00347         evt-&gt;channel = channel;
<a name="l00348"></a>00348         <span class="keywordflow">if</span> (val &lt; 0) val = 0;
<a name="l00349"></a>00349         <span class="keywordflow">if</span> (val &gt; 127) val = 127;
<a name="l00350"></a>00350         evt-&gt;value = val;
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00359"></a>00359 <span class="keywordtype">void</span>
<a name="l00360"></a><a class="code" href="event_8h.html#0ed5faa5be0e0198e5d35e08ed2ab30e">00360</a> <a class="code" href="event_8h.html#0ed5faa5be0e0198e5d35e08ed2ab30e" title="Set a sequencer event to be a volume event.">fluid_event_volume</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> val)
<a name="l00361"></a>00361 {
<a name="l00362"></a>00362         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb0c1bce287e2eb79ab4295ca5a6ecf752" title="Volume set event.">FLUID_SEQ_VOLUME</a>;
<a name="l00363"></a>00363         evt-&gt;channel = channel;
<a name="l00364"></a>00364         <span class="keywordflow">if</span> (val &lt; 0) val = 0;
<a name="l00365"></a>00365         <span class="keywordflow">if</span> (val &gt; 127) val = 127;
<a name="l00366"></a>00366         evt-&gt;value = val;
<a name="l00367"></a>00367 }
<a name="l00368"></a>00368 
<a name="l00375"></a>00375 <span class="keywordtype">void</span>
<a name="l00376"></a><a class="code" href="event_8h.html#d4155fc463ceb4c70e519dbe16b1bb7e">00376</a> <a class="code" href="event_8h.html#d4155fc463ceb4c70e519dbe16b1bb7e" title="Set a sequencer event to be a reverb send event.">fluid_event_reverb_send</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> val)
<a name="l00377"></a>00377 {
<a name="l00378"></a>00378         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640eb970b2bfee1d58337bbe268475d07784e" title="Reverb send set event.">FLUID_SEQ_REVERBSEND</a>;
<a name="l00379"></a>00379         evt-&gt;channel = channel;
<a name="l00380"></a>00380         <span class="keywordflow">if</span> (val &lt; 0) val = 0;
<a name="l00381"></a>00381         <span class="keywordflow">if</span> (val &gt; 127) val = 127;
<a name="l00382"></a>00382         evt-&gt;value = val;
<a name="l00383"></a>00383 }
<a name="l00384"></a>00384 
<a name="l00391"></a>00391 <span class="keywordtype">void</span>
<a name="l00392"></a><a class="code" href="event_8h.html#d82d92ba63ee5cd274728c3da093ce08">00392</a> <a class="code" href="event_8h.html#d82d92ba63ee5cd274728c3da093ce08" title="Set a sequencer event to be a chorus send event.">fluid_event_chorus_send</a>(fluid_event_t* evt, <span class="keywordtype">int</span> channel, <span class="keywordtype">short</span> val)
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394         evt-&gt;type = <a class="code" href="event_8h.html#98ada1fab7a3785a41aa4003645640ebfc06ca89f49f130985ee86e6550b3118" title="Chorus send set event.">FLUID_SEQ_CHORUSSEND</a>;
<a name="l00395"></a>00395         evt-&gt;channel = channel;
<a name="l00396"></a>00396         <span class="keywordflow">if</span> (val &lt; 0) val = 0;
<a name="l00397"></a>00397         <span class="keywordflow">if</span> (val &gt; 127) val = 127;
<a name="l00398"></a>00398         evt-&gt;value = val;
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 <span class="comment">/*</span>
<a name="l00403"></a>00403 <span class="comment"> * Accessing event data</span>
<a name="l00404"></a>00404 <span class="comment"> */</span>
<a name="l00405"></a>00405 
<a name="l00411"></a><a class="code" href="event_8h.html#c3361e1714645e0afbf51ee49e8fee21">00411</a> <span class="keywordtype">int</span> <a class="code" href="event_8h.html#c3361e1714645e0afbf51ee49e8fee21" title="Get the event type (fluid_seq_event_type) field from a sequencer event structure...">fluid_event_get_type</a>(fluid_event_t* evt)
<a name="l00412"></a>00412 {
<a name="l00413"></a>00413         <span class="keywordflow">return</span> evt-&gt;type;
<a name="l00414"></a>00414 }
<a name="l00415"></a>00415 
<a name="l00421"></a>00421 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fluid_event_get_time(fluid_event_t* evt)
<a name="l00422"></a>00422 {
<a name="l00423"></a>00423         <span class="keywordflow">return</span> evt-&gt;time;
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00431"></a><a class="code" href="event_8h.html#44e98166f9bb5dff24dce0a7f8551ba8">00431</a> <span class="keywordtype">short</span> <a class="code" href="event_8h.html#44e98166f9bb5dff24dce0a7f8551ba8" title="Get the source field from a sequencer event structure.">fluid_event_get_source</a>(fluid_event_t* evt)
<a name="l00432"></a>00432 {
<a name="l00433"></a>00433         <span class="keywordflow">return</span> evt-&gt;src;
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00441"></a><a class="code" href="event_8h.html#e55407a115f1efdfefd8cd5ba58faae9">00441</a> <span class="keywordtype">short</span> <a class="code" href="event_8h.html#e55407a115f1efdfefd8cd5ba58faae9" title="Get the dest field from a sequencer event structure.">fluid_event_get_dest</a>(fluid_event_t* evt)
<a name="l00442"></a>00442 {
<a name="l00443"></a>00443         <span class="keywordflow">return</span> evt-&gt;dest;
<a name="l00444"></a>00444 }
<a name="l00445"></a>00445 
<a name="l00451"></a><a class="code" href="event_8h.html#444187d4e75b5d8200bb4465f6b4cf97">00451</a> <span class="keywordtype">int</span> <a class="code" href="event_8h.html#444187d4e75b5d8200bb4465f6b4cf97" title="Get the MIDI channel field from a sequencer event structure.">fluid_event_get_channel</a>(fluid_event_t* evt)
<a name="l00452"></a>00452 {
<a name="l00453"></a>00453         <span class="keywordflow">return</span> evt-&gt;channel;
<a name="l00454"></a>00454 }
<a name="l00455"></a>00455 
<a name="l00461"></a><a class="code" href="event_8h.html#908afd9c4d131fa4817878529be18745">00461</a> <span class="keywordtype">short</span> <a class="code" href="event_8h.html#908afd9c4d131fa4817878529be18745" title="Get the MIDI note field from a sequencer event structure.">fluid_event_get_key</a>(fluid_event_t* evt)
<a name="l00462"></a>00462 {
<a name="l00463"></a>00463         <span class="keywordflow">return</span> evt-&gt;key;
<a name="l00464"></a>00464 }
<a name="l00465"></a>00465 
<a name="l00471"></a><a class="code" href="event_8h.html#a4edc380e491a5631293addb181bbbbb">00471</a> <span class="keywordtype">short</span> <a class="code" href="event_8h.html#a4edc380e491a5631293addb181bbbbb" title="Get the MIDI velocity field from a sequencer event structure.">fluid_event_get_velocity</a>(fluid_event_t* evt)
<a name="l00472"></a>00472 
<a name="l00473"></a>00473 {
<a name="l00474"></a>00474         <span class="keywordflow">return</span> evt-&gt;vel;
<a name="l00475"></a>00475 }
<a name="l00476"></a>00476 
<a name="l00482"></a><a class="code" href="event_8h.html#ce3d7d024c82c0cf22f551663555b667">00482</a> <span class="keywordtype">short</span> <a class="code" href="event_8h.html#ce3d7d024c82c0cf22f551663555b667" title="Get the MIDI control number field from a sequencer event structure.">fluid_event_get_control</a>(fluid_event_t* evt)
<a name="l00483"></a>00483 {
<a name="l00484"></a>00484         <span class="keywordflow">return</span> evt-&gt;control;
<a name="l00485"></a>00485 }
<a name="l00486"></a>00486 
<a name="l00498"></a><a class="code" href="event_8h.html#f87bd46089a8e1dcf8ab61eeb89d8341">00498</a> <span class="keywordtype">short</span> <a class="code" href="event_8h.html#f87bd46089a8e1dcf8ab61eeb89d8341" title="Get the value field from a sequencer event structure.">fluid_event_get_value</a>(fluid_event_t* evt)
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500         <span class="keywordflow">return</span> evt-&gt;value;
<a name="l00501"></a>00501 }
<a name="l00502"></a>00502 
<a name="l00510"></a><a class="code" href="event_8h.html#842943e3b3a61ee3250a975de8895f97">00510</a> <span class="keywordtype">void</span>* <a class="code" href="event_8h.html#842943e3b3a61ee3250a975de8895f97" title="Get the data field from a sequencer event structure.">fluid_event_get_data</a>(fluid_event_t* evt)
<a name="l00511"></a>00511 {
<a name="l00512"></a>00512         <span class="keywordflow">return</span> evt-&gt;data;
<a name="l00513"></a>00513 }
<a name="l00514"></a>00514 
<a name="l00522"></a><a class="code" href="event_8h.html#7690a75128123003d159d6329e0ee819">00522</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="event_8h.html#7690a75128123003d159d6329e0ee819" title="Get the duration field from a sequencer event structure.">fluid_event_get_duration</a>(fluid_event_t* evt)
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524         <span class="keywordflow">return</span> evt-&gt;duration;
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 
<a name="l00535"></a><a class="code" href="event_8h.html#0c2d3bf7d67971cf82d4c0337427c916">00535</a> <span class="keywordtype">short</span> <a class="code" href="event_8h.html#0c2d3bf7d67971cf82d4c0337427c916" title="Get the MIDI bank field from a sequencer event structure.">fluid_event_get_bank</a>(fluid_event_t* evt)
<a name="l00536"></a>00536 {
<a name="l00537"></a>00537         <span class="keywordflow">return</span> evt-&gt;control;
<a name="l00538"></a>00538 }
<a name="l00539"></a>00539 
<a name="l00547"></a><a class="code" href="event_8h.html#9743249d95c8b09308e4ab754ae85172">00547</a> <span class="keywordtype">int</span> <a class="code" href="event_8h.html#9743249d95c8b09308e4ab754ae85172" title="Get the pitch field from a sequencer event structure.">fluid_event_get_pitch</a>(fluid_event_t* evt)
<a name="l00548"></a>00548 {
<a name="l00549"></a>00549         <span class="keywordflow">return</span> evt-&gt;pitch;
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00560"></a>00560 <span class="keywordtype">short</span>
<a name="l00561"></a><a class="code" href="event_8h.html#d85f5b25dcacfd7128b6548c418ca6ff">00561</a> <a class="code" href="event_8h.html#d85f5b25dcacfd7128b6548c418ca6ff" title="Get the MIDI program field from a sequencer event structure.">fluid_event_get_program</a>(fluid_event_t* evt)
<a name="l00562"></a>00562 {
<a name="l00563"></a>00563         <span class="keywordflow">return</span> evt-&gt;value;
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 
<a name="l00573"></a>00573 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00574"></a><a class="code" href="event_8h.html#487737a0f07ac4f33b2f5179f4597c69">00574</a> <a class="code" href="event_8h.html#487737a0f07ac4f33b2f5179f4597c69" title="Get the SoundFont ID field from a sequencer event structure.">fluid_event_get_sfont_id</a>(fluid_event_t* evt)
<a name="l00575"></a>00575 {
<a name="l00576"></a>00576         <span class="keywordflow">return</span> evt-&gt;duration;
<a name="l00577"></a>00577 }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579 
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 <span class="comment">/********************/</span>
<a name="l00582"></a>00582 <span class="comment">/* heap management  */</span>
<a name="l00583"></a>00583 <span class="comment">/********************/</span>
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 fluid_evt_heap_t*
<a name="l00586"></a>00586 _fluid_evt_heap_init(<span class="keywordtype">int</span> nbEvents)
<a name="l00587"></a>00587 {
<a name="l00588"></a>00588 <span class="preprocessor">#ifdef HEAP_WITH_DYNALLOC</span>
<a name="l00589"></a>00589 <span class="preprocessor"></span>
<a name="l00590"></a>00590   <span class="keywordtype">int</span> i;
<a name="l00591"></a>00591   fluid_evt_heap_t* heap;
<a name="l00592"></a>00592   fluid_evt_entry *tmp;
<a name="l00593"></a>00593 
<a name="l00594"></a>00594   heap = FLUID_NEW(fluid_evt_heap_t);
<a name="l00595"></a>00595   <span class="keywordflow">if</span> (heap == NULL) {
<a name="l00596"></a>00596     <a class="code" href="log_8h.html#3daee03b354d1f66f4ee180ca97ccfc6" title="Print a message to the log.">fluid_log</a>(<a class="code" href="log_8h.html#a341232c15addd9c336131984840ed9e62d9ddd89d0a853606ce38d195daa99a" title="The synth can&amp;#39;t function correctly any more.">FLUID_PANIC</a>, <span class="stringliteral">"sequencer: Out of memory\n"</span>);
<a name="l00597"></a>00597     <span class="keywordflow">return</span> NULL;
<a name="l00598"></a>00598   }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600   heap-&gt;freelist = NULL;
<a name="l00601"></a>00601   fluid_mutex_init(heap-&gt;mutex);
<a name="l00602"></a>00602 
<a name="l00603"></a>00603   <span class="comment">/* LOCK */</span>
<a name="l00604"></a>00604   fluid_mutex_lock(heap-&gt;mutex);
<a name="l00605"></a>00605 
<a name="l00606"></a>00606   <span class="comment">/* Allocate the event entries */</span>
<a name="l00607"></a>00607   <span class="keywordflow">for</span> (i = 0; i &lt; nbEvents; i++) {
<a name="l00608"></a>00608     tmp = FLUID_NEW(fluid_evt_entry);
<a name="l00609"></a>00609     tmp-&gt;next = heap-&gt;freelist;
<a name="l00610"></a>00610     heap-&gt;freelist = tmp;
<a name="l00611"></a>00611   }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613   <span class="comment">/* UNLOCK */</span>
<a name="l00614"></a>00614   fluid_mutex_unlock(heap-&gt;mutex);
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 <span class="preprocessor">#else</span>
<a name="l00618"></a>00618 <span class="preprocessor"></span>        <span class="keywordtype">int</span> i;
<a name="l00619"></a>00619         fluid_evt_heap_t* heap;
<a name="l00620"></a>00620         <span class="keywordtype">int</span> siz = 2*<span class="keyword">sizeof</span>(fluid_evt_entry *) + <span class="keyword">sizeof</span>(fluid_evt_entry)*nbEvents;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622         heap = (fluid_evt_heap_t *)FLUID_MALLOC(siz);
<a name="l00623"></a>00623   <span class="keywordflow">if</span> (heap == NULL) {
<a name="l00624"></a>00624     <a class="code" href="log_8h.html#3daee03b354d1f66f4ee180ca97ccfc6" title="Print a message to the log.">fluid_log</a>(<a class="code" href="log_8h.html#a341232c15addd9c336131984840ed9e62d9ddd89d0a853606ce38d195daa99a" title="The synth can&amp;#39;t function correctly any more.">FLUID_PANIC</a>, <span class="stringliteral">"sequencer: Out of memory\n"</span>);
<a name="l00625"></a>00625     <span class="keywordflow">return</span> NULL;
<a name="l00626"></a>00626   }
<a name="l00627"></a>00627   FLUID_MEMSET(heap, 0, siz);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629   <span class="comment">/* link all heap events */</span>
<a name="l00630"></a>00630   {
<a name="l00631"></a>00631         fluid_evt_entry *tmp = &amp;(heap-&gt;pool);
<a name="l00632"></a>00632           <span class="keywordflow">for</span> (i = 0 ; i &lt; nbEvents - 1 ; i++)
<a name="l00633"></a>00633                         tmp[i].next = &amp;(tmp[i+1]);
<a name="l00634"></a>00634                 tmp[nbEvents-1].next = NULL;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636                 <span class="comment">/* set head &amp; tail */</span>
<a name="l00637"></a>00637                 heap-&gt;tail = &amp;(tmp[nbEvents-1]);
<a name="l00638"></a>00638         heap-&gt;head = &amp;(heap-&gt;pool);
<a name="l00639"></a>00639   }
<a name="l00640"></a>00640 <span class="preprocessor">#endif</span>
<a name="l00641"></a>00641 <span class="preprocessor"></span>  <span class="keywordflow">return</span> (heap);
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 <span class="keywordtype">void</span>
<a name="l00645"></a>00645 _fluid_evt_heap_free(fluid_evt_heap_t* heap)
<a name="l00646"></a>00646 {
<a name="l00647"></a>00647 <span class="preprocessor">#ifdef HEAP_WITH_DYNALLOC</span>
<a name="l00648"></a>00648 <span class="preprocessor"></span>  fluid_evt_entry *tmp, *next;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650   <span class="comment">/* LOCK */</span>
<a name="l00651"></a>00651   fluid_mutex_lock(heap-&gt;mutex);
<a name="l00652"></a>00652 
<a name="l00653"></a>00653   tmp = heap-&gt;freelist;
<a name="l00654"></a>00654   <span class="keywordflow">while</span> (tmp) {
<a name="l00655"></a>00655     next = tmp-&gt;next;
<a name="l00656"></a>00656     FLUID_FREE(tmp);
<a name="l00657"></a>00657     tmp = next;
<a name="l00658"></a>00658   }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660   <span class="comment">/* UNLOCK */</span>
<a name="l00661"></a>00661   fluid_mutex_unlock(heap-&gt;mutex);
<a name="l00662"></a>00662   fluid_mutex_destroy(heap-&gt;mutex);
<a name="l00663"></a>00663 
<a name="l00664"></a>00664   FLUID_FREE(heap);
<a name="l00665"></a>00665 
<a name="l00666"></a>00666 <span class="preprocessor">#else</span>
<a name="l00667"></a>00667 <span class="preprocessor"></span>        FLUID_FREE(heap);
<a name="l00668"></a>00668 <span class="preprocessor">#endif</span>
<a name="l00669"></a>00669 <span class="preprocessor"></span>}
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 fluid_evt_entry*
<a name="l00672"></a>00672 _fluid_seq_heap_get_free(fluid_evt_heap_t* heap)
<a name="l00673"></a>00673 {
<a name="l00674"></a>00674 <span class="preprocessor">#ifdef HEAP_WITH_DYNALLOC</span>
<a name="l00675"></a>00675 <span class="preprocessor"></span>  fluid_evt_entry* evt = NULL;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677   <span class="comment">/* LOCK */</span>
<a name="l00678"></a>00678   fluid_mutex_lock(heap-&gt;mutex);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680 <span class="preprocessor">#if !defined(MACOS9)</span>
<a name="l00681"></a>00681 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (heap-&gt;freelist == NULL) {
<a name="l00682"></a>00682     heap-&gt;freelist = FLUID_NEW(fluid_evt_entry);
<a name="l00683"></a>00683     <span class="keywordflow">if</span> (heap-&gt;freelist != NULL) {
<a name="l00684"></a>00684       heap-&gt;freelist-&gt;next = NULL;
<a name="l00685"></a>00685     }
<a name="l00686"></a>00686   }
<a name="l00687"></a>00687 <span class="preprocessor">#endif</span>
<a name="l00688"></a>00688 <span class="preprocessor"></span>
<a name="l00689"></a>00689   evt = heap-&gt;freelist;
<a name="l00690"></a>00690 
<a name="l00691"></a>00691   <span class="keywordflow">if</span> (evt != NULL) {
<a name="l00692"></a>00692     heap-&gt;freelist = heap-&gt;freelist-&gt;next;
<a name="l00693"></a>00693     evt-&gt;next = NULL;
<a name="l00694"></a>00694   }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696   <span class="comment">/* UNLOCK */</span>
<a name="l00697"></a>00697   fluid_mutex_unlock(heap-&gt;mutex);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699   <span class="keywordflow">return</span> evt;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 <span class="preprocessor">#else</span>
<a name="l00702"></a>00702 <span class="preprocessor"></span>        fluid_evt_entry* evt;
<a name="l00703"></a>00703         <span class="keywordflow">if</span> (heap-&gt;head == NULL) <span class="keywordflow">return</span> NULL;
<a name="l00704"></a>00704 
<a name="l00705"></a>00705         <span class="comment">/* take from head of the heap */</span>
<a name="l00706"></a>00706         <span class="comment">/* critical - should threadlock ? */</span>
<a name="l00707"></a>00707         evt = heap-&gt;head;
<a name="l00708"></a>00708         heap-&gt;head = heap-&gt;head-&gt;next;
<a name="l00709"></a>00709 
<a name="l00710"></a>00710         <span class="keywordflow">return</span> evt;
<a name="l00711"></a>00711 <span class="preprocessor">#endif</span>
<a name="l00712"></a>00712 <span class="preprocessor"></span>}
<a name="l00713"></a>00713 
<a name="l00714"></a>00714 <span class="keywordtype">void</span>
<a name="l00715"></a>00715 _fluid_seq_heap_set_free(fluid_evt_heap_t* heap, fluid_evt_entry* evt)
<a name="l00716"></a>00716 {
<a name="l00717"></a>00717 <span class="preprocessor">#ifdef HEAP_WITH_DYNALLOC</span>
<a name="l00718"></a>00718 <span class="preprocessor"></span>
<a name="l00719"></a>00719   <span class="comment">/* LOCK */</span>
<a name="l00720"></a>00720   fluid_mutex_lock(heap-&gt;mutex);
<a name="l00721"></a>00721 
<a name="l00722"></a>00722   evt-&gt;next = heap-&gt;freelist;
<a name="l00723"></a>00723   heap-&gt;freelist = evt;
<a name="l00724"></a>00724 
<a name="l00725"></a>00725   <span class="comment">/* UNLOCK */</span>
<a name="l00726"></a>00726   fluid_mutex_unlock(heap-&gt;mutex);
<a name="l00727"></a>00727 
<a name="l00728"></a>00728 <span class="preprocessor">#else</span>
<a name="l00729"></a>00729 <span class="preprocessor"></span>        <span class="comment">/* append to the end of the heap */</span>
<a name="l00730"></a>00730         <span class="comment">/* critical - should threadlock ? */</span>
<a name="l00731"></a>00731         heap-&gt;tail-&gt;next = evt;
<a name="l00732"></a>00732         heap-&gt;tail = evt;
<a name="l00733"></a>00733         evt-&gt;next = NULL;
<a name="l00734"></a>00734 <span class="preprocessor">#endif</span>
<a name="l00735"></a>00735 <span class="preprocessor"></span>}
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Sat Nov 17 13:40:23 2007 for libfluidsynth by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
